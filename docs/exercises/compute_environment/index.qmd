---
title: Compute environment
author:
  - Per Unneberg
format: html
---

<!-- markdownlint-disable MD041 -->

{{< include ../_knitr.qmd >}}

{{< include ../_rlibs.qmd >}}

<!-- markdownlint-enable MD041 -->

Computer exercise requirements are listed in `Tools` callout blocks in
each exercise. We will primarily use gitpod and JupyterLite for
exercises, which ideally means you do not need to install any software
dependencies yourself. The `Tools` callout block contains listings of
programs, along with specifications for two fallback solutions,
whenever relevant:

1. a [conda](https://docs.conda.io/en/latest/) environment file
2. a list of [UPPMAX](https://www.uppmax.uu.se) modules

::: {.callout-note collapse=true}

## Tools - example

Example Tools block.

:::{.panel-tabset}

### Listing

- [fastqc](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/)
- [bwa](https://github.com/lh3/bwa) [@li_AligningSequenceReads_2013]

### Conda

Copy the contents to a file `environment.yml` and install packages
with `mamba env update -f environment.yml`.

```{lang="text" }
channels:
  - conda-forge
  - bioconda
  - defauts
dependencies:
  - bwa=0.7.17
  - fastqc=0.12.1
```

### UPPMAX modules

Execute the following command to load modules:

```{bash }
#| label: uppmax-load-modules
#| echo: true
#| eval: false
module load uppmax bioinfo-tools bwa/0.7.17 FastQC/0.11.9
```

:::

:::

## gitpod

## JupyterLite

## conda

The first fallback option is to install software packages locally on
your computer. We will use the
[conda](https://docs.conda.io/en/latest/) package manager to install
necessary requirements from the package repositories
[bioconda](https://bioconda.github.io/) and
[conda-forge](https://conda-forge.org/).

### 1. Install conda

To start using conda, follow the [quick command line install
instructions](https://docs.conda.io/en/latest/miniconda.html#quick-command-line-install)
to install the minimal conda installer
[miniconda](https://docs.conda.io/en/latest/miniconda.html).

### 2. Configure conda

Configure conda to access the package repositories (see also [bioconda
usage](https://bioconda.github.io/#usage)). This will modify your
`~/.condarc` file:

```{bash}
#| label: conda-configuration
#| echo: true
#| eval: false
conda config --add channels defaults
conda config --add channels bioconda
conda config --add channels conda-forge
conda config --set channel_priority strict
```

::: {.callout-important}

Please note that the order of these commands is important!

:::

### 3. Create an isolated course environment

It is suggested you create and change to a isolated environment `pgip`
dedicated to the course. We also suggest you use
[mamba](https://mamba.readthedocs.io/en/latest/index.html) package
manager to install programs as this is much quicker.

```{bash }
#| label: create-conda-pgip
#| echo: true
#| eval: false
mamba create -n pgip python=3.10 r-base
mamba activate pgip
```

To deactivate an environment you issue the command `mamba deactivate`.

### 4. Install packages

You can install packages as follows (remember to activate `pgip`!):

```{bash }
#| label: conda-install-packages
#| echo: true
#| eval: false
mamba install bcftools angsd mosdepth
```

or if you have packages listed in an environment file

```{bash }
#| label: conda-install-packages-from-environment-file
#| echo: true
#| eval: false
mamba env update -f environment.yml
```

## UPPMAX

As another fallback option, you may need an [uppmax
account](https://www.uppmax.uu.se/) to run some of the exercises. You
can apply for an account
[here](https://www.uppmax.uu.se/support/getting-started/applying-for-a-user-account/).

### Tutorials

Look at <https://www.uppmax.uu.se/support/user-guides/>, in particular
<https://www.uppmax.uu.se/support/user-guides/guide--first-login-to-uppmax/>
for information on how to connect to and work on uppmax.

## Brief introduction to bash

## References
